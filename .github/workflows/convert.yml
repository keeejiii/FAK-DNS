name: Update DNS Rules

on:
  schedule:
    - cron: "0 22 * * *"  # 每天北京时间早上6点左右运行
  workflow_dispatch:      # 允许你在 Actions 页面手动点击运行

jobs:
  build_and_push:
    runs-on: ubuntu-latest
    
    # ⚠️这里设置你的 DNS IP，请根据需要修改⚠️
    env:
      CN_DNS: "223.5.5.5"
      THE_DNS: "8.8.8.8"

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'

    - name: Download latest data
      run: |
        # 核心步骤：直接从上游下载最新的加速域名列表
        # 这样你就不用同步整个仓库，也能拿到最新数据
        wget https://raw.githubusercontent.com/felixonmars/dnsmasq-china-list/master/accelerated-domains.china.conf -O accelerated-domains.china.conf

    - name: Run conversion script
      run: |
        # 运行你的 Python 脚本
        python convert.py

    - name: Commit and Push changes
      run: |
        # 检查是否有变化并提交
        if [ -f "converted/FAK-DNS.txt" ]; then
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add converted/FAK-DNS.txt
          git commit -m "Auto-update DNS rules" -a || exit 0
          git push
        else
          echo "文件未生成，跳过提交"
        fi
